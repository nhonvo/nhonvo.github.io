---
import { SITE_TITLE, SITE_DESCRIPTION } from "../../config.ts";

import Footer from "$components/Footer.astro";
import Header from "$components/Header.astro";
import BaseLayout from "$layouts/BaseLayout.astro";
import BlogPost from "$layouts/BlogPost.astro";
import { Content } from "$content/info/about.mdx";
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <Header active="about" />

  <main class="max-w-2xl lg:max-w-3xl mx-auto mt-8 px-4">
    <style is:global>
      .prose table img {
        margin: 0 !important;
        max-width: 120px;
        height: auto;
        display: inline-block;
      }
      .prose table td {
        vertical-align: middle;
      }
    </style>
    <BlogPost>

      <Content />
    </BlogPost>
  </main>

  <Footer />

  <!-- Image Viewer Modal -->
  <div id="image-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-base-950/90 backdrop-blur-sm p-4 cursor-zoom-out" aria-hidden="true">
    <div class="relative max-w-5xl w-full h-full flex items-center justify-center">
      <img id="modal-img" src="" alt="" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl transition-transform duration-300" />
      <button id="close-modal" class="absolute top-4 right-4 p-2 rounded-full bg-base-800/50 text-base-100 hover:bg-base-700 transition-colors" aria-label="Close image">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <script>
    function initImageViewer() {
      const modal = document.getElementById('image-modal');
      const modalImg = document.getElementById('modal-img') as HTMLImageElement;
      const closeBtn = document.getElementById('close-modal');
      const prose = document.querySelector('.prose');

      if (!modal || !modalImg || !prose) return;

      const images = prose.querySelectorAll('img');
      images.forEach(img => {
        img.classList.add('cursor-zoom-in', 'hover:opacity-90', 'transition-opacity');
        img.addEventListener('click', () => {
          modalImg.src = img.src;
          modalImg.alt = img.alt;
          modal.classList.remove('hidden');
          document.body.style.overflow = 'hidden';
        });
      });

      const closeModal = () => {
        modal.classList.add('hidden');
        document.body.style.overflow = '';
        setTimeout(() => { modalImg.src = ''; }, 300);
      };

      modal.addEventListener('click', (e) => {
        if (e.target === modal || e.target === modal.firstElementChild) {
          closeModal();
        }
      });

      closeBtn?.addEventListener('click', closeModal);

      // ESC key to close
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
          closeModal();
        }
      });
    }

    document.addEventListener('astro:page-load', initImageViewer);
    initImageViewer();
  </script>
</BaseLayout>

